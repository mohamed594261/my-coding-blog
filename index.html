<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>منصة الدروس الذكية</title>
    
    <style>
        /* 1. تنسيقات التصميم (CSS) التي سألت عنها */
        body { font-family: 'Segoe UI', Tahoma, sans-serif; background-color: #f0f2f5; margin: 0; padding: 0; }
        
        .header { background: #007bff; color: white; padding: 15px 20px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        
        .container { 
            display: grid; 
            grid-template-columns: 280px 1fr; /* تقسيم الصفحة: قائمة جانبية + محتوى */
            gap: 20px; 
            max-width: 1200px; 
            margin: 20px auto; 
            padding: 0 15px;
        }

        .sidebar { background: #fff; padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); height: fit-content; }
        .sidebar h3 { border-bottom: 2px solid #f0f2f5; padding-bottom: 10px; }
        .lesson-list { list-style: none; padding: 0; }
        .lesson-list li { padding: 10px; border-radius: 5px; cursor: pointer; margin-bottom: 5px; transition: 0.3s; background: #f8f9fa; }
        .lesson-list li:hover { background: #e9ecef; }
        .lesson-list li.active { background: #007bff; color: white; }

        .main-content { background: #fff; padding: 30px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        
        .auth-btn { padding: 8px 15px; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; }
        .login { background: #fff; color: #007bff; }
        .logout { background: #dc3545; color: white; }

        .complete-section { margin-top: 40px; text-align: center; padding: 20px; border-top: 1px solid #eee; }
        #btn-done { background: #28a745; color: white; border: none; padding: 12px 25px; border-radius: 5px; cursor: pointer; font-size: 16px; display: none; }
        #status-msg { color: #28a745; font-weight: bold; display: none; }

        /* استجابة للهواتف */
        @media (max-width: 768px) {
            .container { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>

    <div class="header">
        <div id="user-info">جاري التحميل...</div>
        <div id="auth-area">
            <button id="login-btn" class="auth-btn login" onclick="login()" style="display:none;">دخول جوجل</button>
            <button id="logout-btn" class="auth-btn logout" onclick="logout()" style="display:none;">خروج</button>
        </div>
    </div>

    <div class="container">
        <aside class="sidebar">
            <h3>قائمة الدروس</h3>
            <ul class="lesson-list">
                <li class="active">الدرس 1: مقدمة</li>
                <li>الدرس 2: المتغيرات</li>
                <li>الدرس 3: المصفوفات</li>
            </ul>
        </aside>

        <main class="main-content">
            <h1 id="lesson-title">مرحباً بك في درس البرمجة الأول</h1>
            <div class="lesson-text">
                <p>في هذا الدرس سنتعلم أساسيات التعامل مع GitHub و Firebase...</p>
                </div>

            <div class="complete-section">
                <button id="btn-done" onclick="markAsComplete()">إتمام الدرس وإضافة نقاط ✅</button>
                <p id="status-msg">أحسنت! لقد أتممت هذا الدرس بنجاح.</p>
            </div>
        </main>
    </div>

    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

    <script>
        // إعدادات Firebase الخاصة بك
        const firebaseConfig = {
  apiKey: "AIzaSyD4i_EoXZL9B7jhq0rZ3yYntSoZIc6-ibY",
  authDomain: "myprogramingblog-574d6.firebaseapp.com",
  databaseURL: "https://myprogramingblog-574d6-default-rtdb.firebaseio.com",
  projectId: "myprogramingblog-574d6",
  storageBucket: "myprogramingblog-574d6.firebasestorage.app",
  messagingSenderId: "284468923744",
  appId: "1:284468923744:web:75ae36f451d01d4f2e2205",
  measurementId: "G-63QD4Y1RFW"
};
        firebase.initializeApp(firebaseConfig);

        const auth = firebase.auth();
        const db = firebase.database();

        function login() { auth.signInWithPopup(new firebase.auth.GoogleAuthProvider()); }
        function logout() { auth.signOut(); }

        auth.onAuthStateChanged(user => {
            const loginBtn = document.getElementById('login-btn');
            const logoutBtn = document.getElementById('logout-btn');
            const userInfo = document.getElementById('user-info');
            const btnDone = document.getElementById('btn-done');

            if (user) {
                loginBtn.style.display = 'none';
                logoutBtn.style.display = 'block';
                userInfo.innerText = "مرحباً: " + user.displayName;
                checkLessonStatus(user.uid);
            } else {
                loginBtn.style.display = 'block';
                logoutBtn.style.display = 'none';
                userInfo.innerText = "زائر";
                btnDone.style.display = 'none';
            }
        });

        // دالة للتحقق من حالة الدرس وجلب النقاط
function checkLessonStatus(uid) {
    // 1. جلب حالة الدرس
    db.ref('progress/' + uid + '/lesson1').on('value', snap => {
        const btnDone = document.getElementById('btn-done');
        const statusMsg = document.getElementById('status-msg');
        
        if (snap.exists()) {
            btnDone.style.display = 'none';
            statusMsg.style.display = 'block';
            statusMsg.innerHTML = "أحسنت! لقد أتممت هذا الدرس بنجاح ✅";
        } else {
            btnDone.style.display = 'inline-block';
            statusMsg.style.display = 'none';
        }
    });

    // 2. جلب مجموع النقاط وعرضه بجانب الاسم
    db.ref('users/' + uid + '/points').on('value', snap => {
        const points = snap.val() || 0;
        document.getElementById('user-info').innerHTML = 
            `مرحباً: ${auth.currentUser.displayName} | <span style='color:#ffeb3b; font-weight:bold;'>نقاطك: ${points}</span>`;
    });
}

// دالة إتمام الدرس وزيادة النقاط
function markAsComplete() {
    const user = auth.currentUser;
    if (user) {
        // إضافة الدرس للمنجزات
        db.ref('progress/' + user.uid + '/lesson1').set({
            completed: true,
            date: Date.now()
        });

        // زيادة النقاط (مثلاً 50 نقطة لكل درس)
        const pointsRef = db.ref('users/' + user.uid + '/points');
        pointsRef.transaction((currentPoints) => {
            return (currentPoints || 0) + 50;
        });
    }
}
    </script>
</body>
</html>
